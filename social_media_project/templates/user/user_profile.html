<!DOCTYPE html>
{% load static %}
{% include 'user/user_nav_bar.html' %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
   <link rel="stylesheet" href="{% static '/css/dashboard.css' %}" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css"/>

  <script src="{% static '/js/dashboard.js' %}" type="application/javascript"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

</head>
<body onload="LoadPost()">
<script>
$(document).ready(function () {
    console.log("Checking messages...");
    {% if messages %}
        {% for message in messages %}
            console.log("Message:", "{{ message }}");
                console.log("Triggering click event on #load-following-btn...");
                 $('#load-following-btn').click();
        {% endfor %}
    {% endif %}
});
</script>

  <div class="main_content" id="user-profile">
    <div class="profile-container">

        {% if Profiles.cover_photo_url %}
      <img class="cover-image" src="../media/{{Profiles.cover_photo_url}}" alt="Cover Image">
        {% else %}
      <img class="cover-image" src="{% static 'images/cover1.jpg' %}" alt="Cover Image">
        {% endif %}
        {% if Profiles.profile_picture_url %}
      <img class="profile-picture" src="../media/{{Profiles.profile_picture_url}}" alt="Profile Picture">
        {% else %}
      <img class="profile-picture" src="{% static 'images/profile.jpg' %}" alt="Profile Picture">
        {% endif %}
      <div class="no-margin padding_25_margin_-65"><p class="no-margin"><strong>{{user.username}}</strong></p>
        <p class="no-margin"><small>{{Profiles.full_name}}</small></p>
        <p class="no-margin">{{Profiles.bio}}</p>
        <input class="button-12" type="button" onclick="user_details_form('Show_form')" value="Edit Profile">
      </div>
      <div class="counts">
<!--        <div class="count-box" onclick="showFollowing()">-->
        <div class="count-box" id="load-following-btn">
          <div class="count-label">Following</div>
          <div class="count">{{Profiles.no_of_following}}</div>
        </div>
        <div class="count-box"  id="load-followers-btn">
          <div class="count-label">Followers</div>
          <div class="count">{{Profiles.no_of_followers}}</div>
        </div>
        <a href="/manage_post/{{user.user_id}}">  <div class="count-box">
          <div class="count-label">Posts</div>
          <div class="count">{{Profiles.no_of_posts}}</div>
        </div></a>
      </div>
<div id="following-list" class="list hidden">
    <!-- Following items will be populated here -->
</div>


      <div id="followers-list" class="list hidden">
    <!-- Followers items will be populated here -->
      </div>
<script>
<!--    Following Button -->
   $(document).ready(function () {
    // Bind click event to the button
    $('#load-following-btn').click(function () {
        // Make an AJAX request to the 'following' endpoint
        $.ajax({
            url: "{% url 'following' %}", // Use the 'following' URL endpoint
            type: "GET", // Use the GET method
            dataType: "json", // Expect JSON response
            success: function (data) {
                // If the request is successful
                if (data && data.following) {
                $('#following-list').empty();
                    // Iterate through the following list and populate the div
                    var followingList = $('#following-list');
                    $.each(data.following, function(index, item) {
                        var followingItem = '<div class="following-item">' +
<!--                                                '<img class="following-profile" src="../media/images/img1.jpg" alt="Profile Picture">' +-->
                                                '<div class="following-id">' + "@" +item.following + '</div>' +
                                                '<a href="/unfollow/'+item.following+"_"+item.following_id+'"> <button class="friendSuggestionButton">unfollow</button></a>' +
                                            '</div>';
                        followingList.append(followingItem);
                    });
                    // Make the div visible
                    //followingList.removeClass('hidden');

var followers = document.getElementById("followers-list")
var following = document.getElementById("following-list")
    following.style.display = "block"
    followers.style.display = "none"
                }
            },
            error: function (xhr, status, error) {
                // Handle errors if any
                console.error(xhr.responseText);
            }
        });


    });
});

<!--    Followers Button -->
   $(document).ready(function () {
    // Bind click event to the button
    $('#load-followers-btn').click(function () {
        // Make an AJAX request to the 'followers' endpoint
        $.ajax({
            url: "{% url 'followers' %}", // Use the 'following' URL endpoint
            type: "GET", // Use the GET method
            dataType: "json", // Expect JSON response
            success: function (data) {
                // If the request is successful
                if (data && data.followers) {
                $('#followers-list').empty();
                    // Iterate through the following list and populate the div
                    var followersList = $('#followers-list');
                    $.each(data.followers, function(index, item) {
                        var followersItem = '<div class="follower-item">' +
<!--                                                '<img class="follower-profile" src="../media/images/img1.jpg" alt="Profile Picture">' +-->
                                                '<div class="follower-id">' + "@" +item.user_name + '</div>' +
                                                '<a href="/remove/'+item.user_name+"_"+item.following_id+'"> <button class="removeSuggestionButton">remove</button></a>' +
                                            '</div>';

                        followersList.append(followersItem);
                    });
                    // Make the div visible
                    //followingList.removeClass('hidden');

var followers = document.getElementById("followers-list")
var following = document.getElementById("following-list")
    following.style.display = "none"
    followers.style.display = "block"
                }
            },
            error: function (xhr, status, error) {
                // Handle errors if any
                console.error(xhr.responseText);
            }
        });


    });
});

</script>


    </div>
    <form method="post" id="user_details_form" class="form-popup hidden" enctype="multipart/form-data" action="/save_profile/{{user.user_id}}/">
      {% csrf_token %}
      <label for="user_id">User ID:</label>
      <input type="number" id="user_id" name="user_id" readonly value="{{user.user_id}}">

      <label for="full_name">Full Name:</label>
      <input type="text" id="full_name" name="full_name" value="{{Profiles.full_name}}" required>

      <label for="bio">Bio:</label>
      <input type="text" id="bio" name="bio" value="{{Profiles.bio}}">

      <label for="profile_picture_url">Profile Picture URL:</label>

      <input type="file" id="profile_picture_url" accept="image/*" name="profile_picture_url" value="{{Profiles.profile_picture_url}}">

      <label for="cover_photo_url">Cover Photo URL:</label>
      <input type="file" id="cover_photo_url" accept="image/*" name="cover_photo_url" value="{{Profiles.cover_photo_url}}">

      <label for="date_of_birth">Date of Birth:</label>
            <input type="date" id="date_of_birth" name="date_of_birth" value="{{ Profiles.birthdate|date:'Y-m-d' }}" required>

      <div class="gender-group">
          <label>Gender:</label>
          <input type="radio" id="male" name="gender" value="Male" required>
          <label for="male">Male</label>

          <input type="radio" id="female" name="gender" value="Female" required>
          <label for="female">Female</label>

          <input type="radio" id="other" name="gender" value="Other" required>
          <label for="other">Other</label>
      </div>

      <label for="location">Location:</label>
      <input type="text" id="location" name="location" value="{{Profiles.location}}">

      <input type="submit" value="Save">
      <input type="button" class="button-normal" value="Cancel" onclick="user_details_form('Hide_form')">
  </form>


  </div>
</body>
</html>